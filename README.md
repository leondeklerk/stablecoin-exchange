# Stablecoin Demonstrator

This is a demonstration of a stablecoin that builds on the
[TrustChain](https://github.com/Tribler/py-ipv8) blockchain as part of a master
thesis at the  TU Delft Distributed Systems research group.

## General system description

In TrustChain...[x] the authors describe a CAP theorem like tradeoff between
**High Scalability**, **Full Decentralisation** and **Global Consensus**.
Where most blockchains choose until now have chosen Global Consensus and
Decentralisation, TrustChain optimised for scalability and Decentralisation.

This project aims to show how this system and its properties can be used to
create a fabric that the financial infrastructure of tomorrow can build on.

## System components

This prototype consists of 2 components that demonstrate the systems
capabilities.

[**The Wallet**](https://github.com/tribler/trustchain-superapp) is used by
anyone willing to hold and transact the token.

**The Exchange platform (this repo)** is controlled by a (central bank like) issuer. It
exchanges collateral (like Euros) for the Stablecoin.

To add a gateway to the application, either scan a payment QR code, or click the QR icon in the top bar to scan a gateway information QR code.

## Running the Exchange

There are two mains ways to run this exchange, either directly by starting the files; or by using Docker.
Before running make sure to properly clone the repository, including the submodules.

To install the submodules run:
> git submodule update --init

### Docker (Recommended)

Make sure a .env file is created in the root directory of this project, with the following variables:
| Name                    | Default      | Description                                                                                                                  |
| ----------------------- | ------------ | ---------------------------------------------------------------------------------------------------------------------------- |
| GATEWAY_NAME            | Demo Gateway | Name of the exchange                                                                                                         |
| GATEWAY_HOSTNAME        | localhost    | The hostname of the application only used by both front-end and back-end                                                     |
| GATEWAY+IP              | 0.0.0.0      | IP address of the gateway, used for IPV8 connection                                                                          |
| RATE_E2T                | 1.0          | Exchange rate of Euro -> Euro token                                                                                          |
| RATE_T2E                | 1.0          | Exchange rate of Euro token -> Euro                                                                                          |
| TIKKIE_API_KEY          |              | Required API key to use the [Abn Amro Tikkie API](https://developer.abnamro.com/api-products/tikkie/reference-documentation) |
| TIKKIE_SANDBOX_TOKEN    |              | Optional Tikkie sandbox appToken (will be auto generated)                                                                    |
| TIKKIE_PRODUCTION_TOKEN |              | Optional Tikkie Production appToken (cannot be generated)                                                                    |

Also make sure the following folders are created:

- /backend/.local
- /backend/.keys

These folders are automatically bound to the docker stack. `.local` will be where the database is stored, while `.keys` will contain a `.pem` file generated by the application.
If you want to use a previously generated key file, make sure to put the key file named `trustchain_key.pem` in the `.keys` directory. This will automatically be loaded.

First build the docker stack with:
> docker-compose build

Then start the stack with:
> docker-compose  up -d

Access the front-end on `localhost:8080` or via the set hostname if configured.

### Manual

Manual running is not recommended as the system is streamlined for Docker deployment.
The front-end package can be build using:
> npm install && npm run build

By default the API is intended to be ran behind a proxy, where all `/api` calls are redirected to the back-end.

The configuration file for a `nginx` proxy can be found [here](frontend/default.conf).

The back-end can be installed by running:
> pip install -r requirements.txt

And by creating a `.env` file in the back-end folder with (some) the following properties:

| Name                    | Default      | Description                                                                                                                  |
| ----------------------- | ------------ | ---------------------------------------------------------------------------------------------------------------------------- |
| GATEWAY_NAME            | Demo Gateway | Name of the exchange                                                                                                         |
| GATEWAY_HOSTNAME        | localhost    | The hostname of the application only used by both front-end and back-end                                                     |
| GATEWAY+IP              | 0.0.0.0      | IP address of the gateway, used for IPV8 connection                                                                          |
| RATE_E2T                | 1.0          | Exchange rate of Euro -> Euro token                                                                                          |
| RATE_T2E                | 1.0          | Exchange rate of Euro token -> Euro                                                                                          |
| TIKKIE_API_KEY          |              | Required API key to use the [Abn Amro Tikkie API](https://developer.abnamro.com/api-products/tikkie/reference-documentation) |
| TIKKIE_SANDBOX_TOKEN    |              | Optional Tikkie sandbox appToken (will be auto generated)                                                                    |
| TIKKIE_PRODUCTION_TOKEN |              | Optional Tikkie Production appToken (cannot be generated)                                                                    |

Also make sure the following folders are created:

- /backend/.local
- /backend/.keys

These folders are used by the backend. `.local` will be where the database is stored, while `.keys` will contain a `.pem` file generated by the application.
If you want to use a previously generated key file, make sure to put the key file named `trustchain_key.pem` in the `.keys` directory. This will automatically be loaded.

Run the API by executing:

> python run_coin.py

Access the front-end on `localhost:8080` or via the set hostname if configured.
